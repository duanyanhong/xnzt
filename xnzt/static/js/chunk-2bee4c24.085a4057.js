(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2bee4c24"],{"0ee0":function(t,e,o){"use strict";(function(t){o("14d9"),o("a434"),o("e9c4"),o("b64b"),o("d3b7"),o("159b");var i=o("24b9");e["a"]={name:"Role",data:function(){return{rules:{roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"}],menuId:[{type:"array",required:!0,message:"请至少选择一个权限",trigger:"change"}]},dataList:[],total:0,loading:!1,formIsshow:!1,formData:{id:"",roleName:"",menuId:[],buttonCode:[],accessToken:sessionStorage.getItem("xn_token")},jsHeight:500,editStatus:!1,titleContent:"管理角色",menus:[],buttons:[],defaultSelect:[],title:"",limit:20,page:1,pageSizes:[20,50,100]}},mounted:function(){this.loadData()},activated:function(){var t=this;this.$nextTick((function(){t.$refs.plTable.doLayout()}))},methods:{loadData:function(){var e=this;this.loading=!0;var o={page:this.page,limit:this.limit,accessToken:sessionStorage.getItem("xn_token")};Object(i["e"])(o).then((function(o){o&&(e.loading=!1,e.dataList=o.msgData.list.items,e.total=o.msgData.list.total,e.menus=o.msgData.menus,e.jsHeight=window.innerHeight-t(".crud-opts").outerHeight()-180)}))},addShow:function(){this.editStatus=!1,void 0!==this.$refs["formData"]&&this.$refs["formData"].resetFields(),this.formData.roleName="",void 0!==this.$refs.tree&&this.$refs.tree.setCheckedKeys([]),this.formData.menuId=[],this.formData.buttonCode=[],this.defaultSelect=[],this.buttons=[],this.title="",this.formIsshow=!0},addForm:function(){var t=this;this.$refs["formData"].validate((function(e){if(!e)return!1;var o=t;o.editStatus?Object(i["c"])(o.formData).then((function(t){t&&(o.formIsshow=!1,o.$modal.notifySuccess(t.errMsg),o.loadData())})):Object(i["a"])(o.formData).then((function(t){t&&(o.formIsshow=!1,o.$modal.notifySuccess(t.errMsg),o.loadData())}))}))},editStaff:function(t){void 0!==this.$refs["formData"]&&this.$refs["formData"].resetFields(),void 0!==this.$refs.tree&&this.$refs.tree.setCheckedKeys([]),this.formData.id=t.id,this.formData.roleName=t.roleName,this.defaultSelect=JSON.parse(JSON.stringify(t.menuIds)),void 0!==this.$refs.tree&&this.$refs.tree.setCheckedKeys(JSON.parse(JSON.stringify(t.menuIds))),this.formData.menuId=JSON.parse(JSON.stringify(t.menuIds)),this.formData.buttonCode=JSON.parse(JSON.stringify(t.buttonCodes)),this.buttons=[],this.title="",this.editStatus=!0,this.formIsshow=!0},editDisable:function(t){var e=this;this.$refs["popover-".concat(t.$index)].doClose();var o={id:t.row.id,accessToken:sessionStorage.getItem("xn_token")};Object(i["b"])(o).then((function(t){t&&(e.$modal.notifySuccess(t.errMsg),e.loadData())}))},currentChecked:function(t){var e=this;this.formData.menuId=this.$refs.tree.getCheckedKeys();var o=this.$refs.tree.getCheckedNodes().indexOf(t)>-1;this.menus.forEach((function(i){i.id!=t.id?i.children.forEach((function(i){i.id!=t.id?i.children.forEach((function(i){i.id!=t.id||e.getAllButton(i,o)})):e.getAllButton(i,o)})):e.getAllButton(i,o)}))},getAllButton:function(t,e){var o=this;this.title=t.label,this.buttons=[],"Layout"==t.component&&t.children.forEach((function(t){"ParentView"==t.component?t.children.forEach((function(t){o.setMenuButton(t.id,e,!1)})):o.setMenuButton(t.id,e,!1)})),"ParentView"==t.component&&t.children.forEach((function(t){o.setMenuButton(t.id,e,!1)})),"Layout"!=t.component&&"ParentView"!=t.component&&this.setMenuButton(t.id,e,!0)},setMenuButton:function(t,e,o){var a=this,n={menuId:t,accessToken:sessionStorage.getItem("xn_token")};Object(i["d"])(n).then((function(t){t&&(t.msgData.buttons.forEach((function(t){if(e)-1===a.formData.buttonCode.indexOf(t.buttonCode)&&a.formData.buttonCode.push(t.buttonCode);else{var o=a.formData.buttonCode.indexOf(t.buttonCode);-1!==o&&a.formData.buttonCode.splice(o,1)}})),o&&(a.buttons=t.msgData.buttons))}))},handleNodeClick:function(t){var e=this;if(this.title=t.label,"Layout"!=t.component&&"ParentView"!=t.component){var o={menuId:t.id,accessToken:sessionStorage.getItem("xn_token")};Object(i["d"])(o).then((function(t){t&&(e.buttons=t.msgData.buttons)}))}else this.buttons=[]}}}}).call(this,o("1157"))},"24b9":function(t,e,o){"use strict";o.d(e,"e",(function(){return a})),o.d(e,"c",(function(){return n})),o.d(e,"a",(function(){return s})),o.d(e,"b",(function(){return r})),o.d(e,"d",(function(){return l}));var i=o("b775");function a(t){return Object(i["a"])({url:"xnkj/user/role/roleList",method:"post",data:t})}function n(t){return Object(i["a"])({url:"xnkj/user/role/editRole",method:"post",data:t})}function s(t){return Object(i["a"])({url:"xnkj/user/role/addRole",method:"post",data:t})}function r(t){return Object(i["a"])({url:"xnkj/user/role/disableRole",method:"post",data:t})}function l(t){return Object(i["a"])({url:"xnkj/user/role/getButton",method:"post",data:t})}},"4bc4":function(t,e,o){"use strict";o.r(e);var i=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"app-container"},[o("el-row",{attrs:{gutter:20}},[o("el-col",[o("div",{staticClass:"crud-opts"},[o("span",{staticClass:"crud-opts-left"},[t._t("left"),o("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["User:Role:Add"],expression:"['User:Role:Add']"}],staticClass:"filter-item",attrs:{size:"mini",type:"primary",icon:"el-icon-plus",plain:""},on:{click:t.addShow}},[t._v(" 新增 ")]),t._t("right")],2)]),o("u-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"plTable",attrs:{data:t.dataList,height:t.jsHeight,"use-virtual":"","row-height":50,stripe:"","header-cell-style":{background:"#f8f8f9",color:"#515a6e",fontSize:"13px",height:"45px",border:"none"},"cell-style":{border:"none"}}},[o("u-table-column",{attrs:{"show-overflow-tooltip":!0,prop:"roleName",label:"角色名称"}}),o("u-table-column",{attrs:{label:"是否禁用"},scopedSlots:t._u([{key:"default",fn:function(e){return["是"==e.row.disable?o("el-tag",{attrs:{type:"danger"}},[t._v(t._s(e.row.disable))]):"否"==e.row.disable?o("el-tag",{attrs:{type:"success"}},[t._v(t._s(e.row.disable))]):t._e()]}}])}),o("u-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["User:Role:Edit"],expression:"['User:Role:Edit']"}],staticStyle:{width:"50px"},attrs:{size:"mini",type:"text",icon:"el-icon-edit"},on:{click:function(o){return t.editStaff(e.row)}}},[t._v("修改")]),"否"==e.row.disable?o("el-popover",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["User:Role:Disable"],expression:"['User:Role:Disable']"}],ref:"popover-"+e.$index,attrs:{placement:"top",width:"200"}},[o("p",{staticStyle:{"line-height":"40px"}},[o("i",{staticClass:"el-icon-info",staticStyle:{color:"rgb(255,153,0)"}}),t._v(" 确定禁用吗？")]),o("div",{staticStyle:{"text-align":"right",margin:"0"}},[o("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(o){t.$refs["popover-"+e.$index].doClose()}}},[t._v("取消")]),o("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(o){return t.editDisable(e)}}},[t._v("确定")])],1),o("el-button",{staticStyle:{width:"50px"},attrs:{slot:"reference",type:"text",icon:"el-icon-lock",size:"mini"},slot:"reference"},[t._v("禁用")])],1):t._e(),"是"==e.row.disable?o("el-popover",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["User:Role:Disable"],expression:"['User:Role:Disable']"}],ref:"popover-"+e.$index,attrs:{placement:"top",width:"200"}},[o("p",{staticStyle:{"line-height":"40px"}},[o("i",{staticClass:"el-icon-info",staticStyle:{color:"rgb(255,153,0)"}}),t._v(" 确定启用吗？")]),o("div",{staticStyle:{"text-align":"right",margin:"0"}},[o("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(o){t.$refs["popover-"+e.$index].doClose()}}},[t._v("取消")]),o("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(o){return t.editDisable(e)}}},[t._v("确定")])],1),o("el-button",{staticClass:"el-button--success",staticStyle:{width:"50px"},attrs:{slot:"reference",type:"text",icon:"el-icon-unlock",size:"mini"},slot:"reference"},[t._v("启用")])],1):t._e()]}}])})],1),o("pagination",{attrs:{limit:t.limit,page:t.page,total:t.total,"page-sizes":t.pageSizes},on:{"update:limit":function(e){t.limit=e},"update:page":function(e){t.page=e},"update:pageSizes":function(e){t.pageSizes=e},"update:page-sizes":function(e){t.pageSizes=e},pagination:t.loadData}})],1)],1),o("el-dialog",{attrs:{"append-to-body":"","close-on-click-modal":!1,visible:t.formIsshow,title:t.titleContent,width:"600px"},on:{"update:visible":function(e){t.formIsshow=e}}},[o("el-form",{ref:"formData",attrs:{inline:!0,model:t.formData,rules:t.rules,size:"small","label-width":"80px"}},[o("el-form-item",{attrs:{label:"角色名称",prop:"roleName"}},[o("el-input",{staticStyle:{width:"400px"},attrs:{placeholder:"请输入角色名称"},model:{value:t.formData.roleName,callback:function(e){t.$set(t.formData,"roleName",e)},expression:"formData.roleName"}})],1),o("el-form-item",[o("div",{staticStyle:{width:"280px",float:"left"}},[o("div",{staticStyle:{"margin-left":"10px","font-weight":"bold"}},[t._v("菜单权限")]),o("el-tree",{ref:"tree",style:{height:"350px",overflow:"auto"},attrs:{data:t.menus,"show-checkbox":"","default-checked-keys":t.defaultSelect,"node-key":"id","default-expand-all":!0,"expand-on-click-node":!1},on:{check:t.currentChecked,"node-click":t.handleNodeClick}})],1),o("div",{staticStyle:{width:"220px",float:"right","margin-left":"20px"}},[o("div",{staticStyle:{"font-weight":"bold"}},[t._v("按钮权限"),""!=t.title?o("span",[t._v("("+t._s(t.title)+")")]):t._e()]),o("el-checkbox-group",{staticStyle:{"align-items":"baseline",height:"350px","overflow-y":"auto"},model:{value:t.formData.buttonCode,callback:function(e){t.$set(t.formData,"buttonCode",e)},expression:"formData.buttonCode"}},t._l(t.buttons,(function(e,i){return o("el-checkbox",{key:e.buttonCode,staticStyle:{width:"180px !important"},attrs:{label:e.buttonCode}},[t._v(t._s(e.buttonName))])})),1)],1)])],1),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{type:"text"},on:{click:function(e){t.formIsshow=!1}}},[t._v("取消")]),o("el-button",{directives:[{name:"debounce",rawName:"v-debounce",value:t.addForm,expression:"addForm"}],attrs:{type:"primary"}},[t._v("确认")])],1)],1)],1)},a=[],n=o("0ee0"),s=n["a"],r=o("2877"),l=Object(r["a"])(s,i,a,!1,null,null,null);e["default"]=l.exports}}]);